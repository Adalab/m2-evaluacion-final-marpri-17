"use strict";const input=document.querySelector(".js-input"),btnSearch=document.querySelector(".js-search"),seriesList=document.querySelector(".js-list"),favoritesList=document.querySelector(".js-favorite-list"),favoritesSection=document.querySelector(".series__section");let searchResult=[],favorites=[];const getInputValue=()=>input.value,clearListResult=e=>e.innerHTML="",pickedItem=(e,t)=>{e.preventDefault();let s=e.currentTarget;return t[parseInt(s.getAttribute("data-ada-pos"))]},isFavorite=(e,t)=>{const s=e.id;for(let e=0;e<t.length;e++){if(s===t[e].id)return!0}return!1},arrConstructor=e=>{clearListResult(seriesList),searchResult=[];for(let t=0;t<e.length;t++)if(e[t].show.image)searchResult.push({name:e[t].show.name,image:e[t].show.image.original,id:e[t].show.id});else{const s=e[t].show.name.replace(" ","+");searchResult.push({name:e[t].show.name,image:"https://via.placeholder.com/300?text="+s,id:e[t].show.id})}return searchResult},showData=e=>{for(let t=0;t<e.length;t++){const s=document.createElement("li");let a=document.createElement("img"),i=document.createElement("h2");s.appendChild(a),s.appendChild(i),seriesList.appendChild(s);let r=document.createTextNode(`${e[t].name}`);i.appendChild(r),a.style=`background-image: url(${e[t].image}`,s.dataset.adaPos=[t],s.classList.add("series__item","js-item"),a.classList.add("series__image"),i.classList.add("series__show")}},toggleView=e=>{e.classList.remove("series__item"),e.classList.add("favorite__item");let t=e.children[1];t.classList.remove("series__show"),t.classList.add("favorite__txt")},pickedFavorite=e=>{let t=[],s=localStorage.getItem("favorite");if(null!==s){let a=JSON.parse(s);for(let s=0;s<a.length;s++){let i=a[s].id;for(let s=0;s<e.length;s++){e[s].id===i&&t.push(s)}}}return t},paintView=e=>{let t=seriesList.children;for(let s=0;s<t.length;s++){let a=parseInt(t[s].getAttribute("data-ada-pos"));for(let s=0;s<e.length;s++)e[s]===a&&toggleView(t[a])}},addListeners=(e,t)=>{const s=document.querySelectorAll(e);for(let e of s)e.addEventListener("click",t)},showDataFavorites=e=>{for(let t=0;t<e.length;t++){const s=document.createElement("li");let a=document.createElement("img"),i=document.createElement("h2");s.appendChild(a),s.appendChild(i),favoritesList.appendChild(s);let r=document.createTextNode(`${e[t].name}`);i.appendChild(r),s.dataset.adaPos=[t],a.style=`background-image: url(${e[t].image}`,s.classList.add("series__item--favorite","js-item-favorite"),a.classList.add("series__image--favorite"),i.classList.add("series__show--favorite")}},addFavorites=e=>favorites.unshift(e),deleteItem=e=>{for(let t=0;t<favorites.length;t++)if(e.id===favorites[t].id)return favorites.splice(t,1),favorites},checkView=e=>{seriesList[e]},saveLocalStorage=()=>{localStorage.setItem("favorite",JSON.stringify(favorites))},getDatafromServer=e=>{e.preventDefault();fetch("http://api.tvmaze.com/search/shows?q="+getInputValue()).then(e=>e.json()).then(e=>{e=arrConstructor(e),showData(e),paintView(pickedFavorite(e)),addListeners(".js-item",handlerFavorites)})},handlerFavorites=e=>{let t=e.currentTarget;toggleView(t);const s=pickedItem(e,searchResult);!1===isFavorite(s,favorites)&&addFavorites(s),saveLocalStorage(),clearListResult(favoritesList),showDataFavorites(favorites),addListeners(".js-item-favorite",deleteFavorite)},deleteFavorite=e=>{const t=pickedItem(e,JSON.parse(localStorage.getItem("favorite")));deleteItem(t),saveLocalStorage(),clearListResult(favoritesList),showDataFavorites(favorites),addListeners(".js-item-favorite",deleteFavorite),clearListResult(seriesList),showData(searchResult),paintView(pickedFavorite(searchResult)),addListeners(".js-item",handlerFavorites)};function starApp(){const e=localStorage.getItem("favorite");null!==e&&(favorites=JSON.parse(e),showDataFavorites(favorites)),addListeners(".js-item-favorite",deleteFavorite)}starApp(),btnSearch.addEventListener("click",getDatafromServer);