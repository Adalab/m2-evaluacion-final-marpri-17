"use strict";const input=document.querySelector(".js-input"),btnSearch=document.querySelector(".js-search"),seriesList=document.querySelector(".js-list"),favoritesList=document.querySelector(".js-favorite-list"),favoritesSection=document.querySelector(".series__section");let searchResult=[],favorites=[];const getInputValue=()=>input.value,clearListResult=e=>e.innerHTML="",pickedItem=(e,t)=>{e.preventDefault();let a=e.currentTarget;return t[parseInt(a.getAttribute("data-ada-pos"))]},isFavorite=e=>{const t=e.id;for(let e=0;e<favorites.length;e++){if(t===favorites[e].id)return!0}return!1},arrConstructor=e=>{clearListResult(seriesList),searchResult=[];for(let t=0;t<e.length;t++)if(e[t].show.image)searchResult.push({name:e[t].show.name,image:e[t].show.image.original,id:e[t].show.id});else{const a=e[t].show.name.replace(" ","+");searchResult.push({name:e[t].show.name,image:"https://via.placeholder.com/300?text="+a,id:e[t].show.id})}return searchResult},showData=e=>{for(let t=0;t<e.length;t++){const a=document.createElement("li");let s=document.createElement("img"),r=document.createElement("h2");a.appendChild(s),a.appendChild(r),seriesList.appendChild(a);let i=document.createTextNode(`${e[t].name}`);r.appendChild(i),s.style=`background-image: url(${e[t].image}`,a.dataset.adaPos=[t],a.classList.add("series__item","js-item"),s.classList.add("series__image"),r.classList.add("series__show")}},addListeners=(e,t)=>{const a=document.querySelectorAll(e);for(let e of a)e.addEventListener("click",t)},showDataFavorites=e=>{for(let t=0;t<e.length;t++){const a=document.createElement("li");let s=document.createElement("img"),r=document.createElement("h2");a.appendChild(s),a.appendChild(r),favoritesList.appendChild(a);let i=document.createTextNode(`${e[t].name}`);r.appendChild(i),s.style=`background-image: url(${e[t].image}`,a.classList.add("series__item--favorite","js-item-favorite"),s.classList.add("series__image--favorite"),r.classList.add("series__show--favorite"),a.dataset.adaPos=[t]}},addFavorites=e=>{favorites.push(e)},saveLocalStorage=()=>{localStorage.setItem("favorite",JSON.stringify(favorites))},getDatafromServer=e=>{e.preventDefault();fetch("http://api.tvmaze.com/search/shows?q="+getInputValue()).then(e=>e.json()).then(e=>{e=arrConstructor(e),showData(e),addListeners(".js-item",handlerFavorites)})};btnSearch.addEventListener("click",getDatafromServer);const deleteItem=e=>{for(let t=0;t<favorites.length;t++)if(e.id===favorites[t].id)return favorites.splice(t,1),favorites},deleteFavorite=e=>{const t=pickedItem(e,JSON.parse(localStorage.getItem("favorite")));deleteItem(t),saveLocalStorage(),clearListResult(favoritesList),showDataFavorites(favorites),addListeners(".js-item-favorite",deleteFavorite)},handlerFavorites=e=>{const t=pickedItem(e,searchResult);!1===isFavorite(t)&&addFavorites(t),saveLocalStorage(),clearListResult(favoritesList),showDataFavorites(favorites),addListeners(".js-item-favorite",deleteFavorite)};function starApp(){const e=localStorage.getItem("favorite");null!==e&&(favorites=JSON.parse(e),showDataFavorites(favorites)),addListeners(".js-item-favorite",deleteFavorite)}starApp();